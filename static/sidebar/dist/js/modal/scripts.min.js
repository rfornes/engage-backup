!function(a,b){function c(){this.initConfig=function(a){return d(a)&&d(a.loginId)&&d(a.domain)&&d(a.logUrl)?void _tvpa.push(["config",{logUrl:a.logUrl,li:a.loginId,gaDomain:a.domain}]):console.log("need config")},this.track=function(a,b){return a&&b&&_tvpa?void _tvpa.push(["track",a,b]):console.log("no data")}}var d=function(a,b){var c=a;return b&&(c=a[b]),"undefined"!=typeof c};a.Analytics=c}(window,document),function(a,b){function c(c,h,i){if(!c||!e(h)||!e(h.data)||h.data.length<=0)return console.log("bad args");this.autoplay=!!e(h.autoplay)&&h.autoplay,this.autonext=!e(h.autonext)||h.autonext,this.version=e(h.version)?h.version:"1.8.5",this.progresscolor=e(h.progresscolor)?h.progresscolor:"#E57211",this.transcript=!!e(h.transcript)&&h.transcript,this.removecontrols=e(h.removecontrols)?h.removecontrols:["hd"],this.analytics=!e(h.analytics)||h.analytics,this.instance=null,this.el="string"==typeof c?b.getElementById(c):c,this.assets=function(a){for(var b=[],c=a.length;c>0;){var d=a[c-1];if(f(d))return console.log("empty data");var g=d.asset;g.uniqueId=d.id,g.loginId=d.loginId,e(d,"events")&&d.events.length?(g.analyticsLogUrl=d.analytics,g.analyticsObj=d.events[1].data,console.log("OBJECT TO BE TRACKED (analyticsObj)",g.analyticsObj)):g.analyticsObj={pg:e(d,"parentId")?d.parentId:e(h,"channel")?h.channel.id:0,vd:d.id,li:d.loginId},g.sources||(g.sources=[{file:g.videoId}]),g.type=g.type||"youtube",b.push(g),c--}return b}(h.data),this.hideEl=function(a){return a.style.display="none"};var j=this;this.showPlayBtn=function(a){var c=document.createDocumentFragment(),d=b.createElement("div");d.classList.add("tvp-mp4-poster"),d.style.backgroundImage='url("'+a+'")',c.appendChild(d);var e=this.el.parentNode.getElementsByClassName("tvp-play")[0];e.style.display="block",e.onclick=function(){j.instance&&(j.hideEl(d),j.hideEl(e),j.instance.play())},c.appendChild(e),this.el.appendChild(c)},this.play=function(a,b){if(!a)return console.log("need asset");var c=!1,d=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);b?(d||e(this.autonext)&&!this.autonext)&&(c=!0):(d||e(this.autoplay)&&!this.autoplay)&&(c=!0);var f=new Analytics,g={domain:e(location,"hostname")?location.hostname:"",loginId:a.loginId};e(a,"analyticsLogUrl")?(console.log("ANALYTICS LOG URL",a.analyticsLogUrl),g.logUrl=a.analyticsLogUrl,f.initConfig(g)):(g.logUrl="//api.tvpage.com/v1/__tvpa.gif",f.initConfig(g)),c?(this.instance.cueVideo(a),"mp4"===a.type&&this.showPlayBtn(a.thumbnailUrl)):this.instance.loadVideo(a)};var k=0;!function b(){setTimeout(function(){e(a,"TVPage")&&e(a,"_tvpa")?new TVPage.player({poster:!0,techOrder:"html5,flash",analytics:{tvpa:j.analytics},apiBaseUrl:"//api.tvpage.com/v1",swf:"//appcdn.tvpage.com/player/assets/tvp/tvp-"+j.version+"-flash.swf",onReady:function(b,c){j.instance=c;var f=g(function(){c&&!d&&j.instance.resize(j.el.parentNode.clientWidth,j.el.parentNode.clientHeight)},180);f(),a.frameElement?a["_tvp_"+h.widgetId]=c:a.addEventListener("resize",f),j.el.querySelector(".tvp-progress-bar").style.backgroundColor=j.progresscolor;var k=0;if(i&&i.length)for(var l=0;l<j.assets.length;l++)j.assets[l].uniqueId===i&&(k=l);j.current=k,j.play(j.assets[j.current]),a.DEBUG&&console.debug("endTime = "+performance.now()),e(a,"BigScreen")&&(BigScreen.onchange=function(){d=!d,a["_tvp_"+h.widgetId+"isFullScreen"]=d})},onStateChange:function(a){"tvp:media:videoended"===a&&(e(j.autonext)&&j.autonext&&(j.current++,j.assets[j.current]||(j.current=0)),j.play(j.assets[j.current],!0))},divId:j.el.id,controls:{active:!0,floater:{removeControls:j.removecontrols,transcript:j.transcript}}}):++k<20?b():console.log("limit reached")},300)}()}var d=!1,e=function(a,b){var c=a;return b&&(c=a[b]),"undefined"!=typeof c},f=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},g=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}};a.Player=c}(window,document),function(a,b,c){var d=Widget.settings,e=function(a,b){if(a&&"object"==typeof b)return a.replace(/\{([\w\.]*)\}/g,function(a,c){for(var d=c.split("."),e=b[d.shift()],f=0,g=d.length;f<g;f++)e=e[d[f]];return"undefined"!=typeof e&&null!==e?e:""})},f=function(a,b){var c=a;return b&&(c=a[b]),"undefined"!=typeof c},g=function(a){for(var b=a.length,f=c("#productTemplate").html(),g=c("#productPopupTemplate").html(),h="",i="";b>0;){var j=a[b-1];i+=e(f,j),h+=e(g,j),b--}var k=c("#"+d.name).find(".tvp-products");k.html(i);var l=k.parent();l.append(h),setTimeout(function(){k.addClass("first-render");var a=l.find("#tvp-arrow-indicator");l.on("mouseleave",function(){c(this).removeClass("active"),a.css("display","none"),l.find(".tvp-product-popup.active").hide()}),k.on("mouseover",".tvp-product",function(b){l.find(".tvp-product-popup.active").hide();var d=c(this).addClass("active"),e=l.find("#tvp-product-popup-"+d.attr("id").split("-").pop()),f=d.position().top,g=f+e.outerHeight();f<0?f=0:g>l.outerHeight()&&(f=f-(g-l.outerHeight())+1),a.css({top:d.position().top+20,display:"block"}),e.css({top:f}),e.show().addClass("active")})},5)};window.addEventListener("message",function(a){if(a&&f(a,"origin")&&"http://localhost:1313"===a.origin&&f(a,"data")&&f(a.data,"videos")){var b=a.data,e=b.videos,h=b.selected;d.data=e,new Player("tvp-player-el",d,h);for(var i={},j=0;j<e.length;j++)e[j].id===h&&(i=e[j]);f(i,"products")?g(i.products):c.ajax({type:"GET",url:"//api.tvpage.com/v1/videos/"+h+"/products",dataType:"jsonp",data:{"X-login-id":d.loginId}}).done(function(a){return a||a.length?void g(a):console.log("no products")})}})}(document,parent.document,jQuery);