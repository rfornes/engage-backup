!function(a,b){function c(){this.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this.isset=function(a,b){var c=o;return p&&(c=o[p]),"undefined"!=typeof c},this.tmpl=function(a,b){if(a&&"object"==typeof b)return a.replace(/\{([\w\.]*)\}/g,function(a,c){for(var d=c.split("."),e=b[d.shift()],f=0,g=d.length;f<g;f++)e=e[d[f]];return"undefined"!=typeof e&&null!==e?e:""})}}a.Utils=new c}(window,document),function(a,b){function c(a){return $.ajax({url:"//local.tvpage.com/tvad/adx/spot",dataType:"json",xhrFields:{},data:{p:a,n:1,si:1,li:1,"X-login-id":1}})}function d(a,d){var e=function(a,b){if(a&&"object"==typeof b)return a.replace(/\{([\w\.]*)\}/g,function(a,c){for(var d=c.split("."),e=b[d.shift()],f=0,g=d.length;f<g;f++)e=e[d[f]];return"undefined"!=typeof e&&null!==e?e:""})};this.loading=!1,this.lastPageReached=!1,this.page=0,this.el="string"==typeof a?b.getElementById(a):a,this.loadMoreBtn=this.el.getElementsByClassName("tvp-load-more")[0],this.render=function(a){for(var c=a.slice(0),d=[];c.length;)d.push(c.splice(0,2));for(var f=b.createDocumentFragment(),g=0;d.length>g;g++){var h=d[g],i=b.createElement("div");i.classList.add("tvp-clearfix");for(var j=0;j<h.length;j++){var k=h[j];"undefined"!=typeof k.entity&&(k.className="tvp-exchange"),i.innerHTML+=e(b.getElementById("videoTemplate").innerHTML,h[j])}f.appendChild(i)}var l=this.el.getElementsByClassName("tvp-container")[0];l.innerHTML="",l.appendChild(f),this.el.classList.add("first-render")},"undefined"!=typeof d.initial&&this.render(d.initial);var f=this;this.loadMoreBtn.onclick=function(){if(!f.loading){f.loading=!0,f.lastPageReached?(f.page=0,f.lastPageReached=!1):f.page++;var a=b.createElement("script"),e="//api.tvpage.com/v1/channels/"+d.channelid+"/videos?X-login-id=";e+=d.loginId+"&callback=tvpcallback&p="+f.page+"&n="+d.itemsperpage,a.src=e,c(f.page).done(function(c){window.tvpcallback=function(a){if(f.loading=!1,!a||!a.length||a.length<d.itemsperpage)f.lastPageReached=!0;else{for(var b=c.length;b>0;){var e=c[b-1];e=$.extend(e,e.entity),b--}f.render($.merge(c,a))}},b.body.appendChild(a)})}}}a.Grid=d}(window,document),function(a,b,c){for(var d="undefined"!=typeof xchData||[],e=d.length;e>0;){var f=d[e-1];f=b.extend(f,f.entity),e--}var g=[];for(var h in Widget.videosObj)g.push(Widget.videosObj[h]);g=d.concat(g);var i=Widget.settings;i.initial=g;var j=i.name;new Grid(j,i),a.getElementById(j).addEventListener("click",function(b){var d=b.target;if(d.classList.contains("tvp-video")){for(var e=d.id.split("-").pop(),f={},h=0;h<g.length;h++)g[h].id===e&&(f=g[h]);var i=a.createElement("div");i.classList.add("tvp-modal-overlay");var k=a.createDocumentFragment();k.appendChild(i);var l=a.createElement("div");l.classList.add("tvp-modal"),l.innerHTML=c.tmpl(a.getElementById("modalTemplate").innerHTML,{src:Widget.baseUrl+"/tvpwidget/"+j+"-modal"+(c.isMobile?"-mobile":""),title:f.title||""}),k.appendChild(l);var m=function(){i.removeEventListener("click",m,!1),i.remove(),l.remove()};k.querySelector(".tvp-modal-close").addEventListener("click",m),i.addEventListener("click",m);var n=k.querySelector(".tvp-iframe-modal");n.onload=function(){var a=this.contentWindow;a.postMessage({selected:e,videos:g,page:0},Widget.baseUrl);var b=this,c=0,d=a.document.body.querySelector(".iframe-content");!function a(){setTimeout(function(){d.querySelector(".tvp-products").classList.contains("first-render")?b.style.height=d.offsetHeight+"px":++c<20?a():console.log("limit reached")},200)}()},parent.document.body.appendChild(k)}})}(document,jQuery,Utils);